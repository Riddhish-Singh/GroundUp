<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groundup Salary Slip Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        /* Base styles */
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); } 

        /* Header and Logo */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .header img { 
            max-width: 150px; 
            height: auto; 
            margin-bottom: 10px; 
            border: none; 
            padding: 5px; 
        }
        .header h1 { font-size: 1.8rem; color: #333; margin-bottom: 5px;}
        .header p { font-size: 1rem; color: #555; }

        /* Two-Column Generator Layout */
        .generator-section { display: flex; gap: 30px; }
        .input-form, .payslip { padding: 0; border: none; border-radius: 0; }
        .input-form { width: 35%; background-color: #f9f9f9; padding: 15px; border: 1px solid #ddd; border-radius: 5px;}
        .payslip { width: 65%; background-color: #fff; padding: 10px 0; }

        /* Form styling */
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 3px; color: #333; }
        .form-group input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; font-size: 0.9rem; }
        .form-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid #555; padding-bottom: 5px; color: #007bff; }
        .input-form button { width: 100%; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; margin-top: 15px; }
        .input-form button:hover { background-color: #0056b3; }

        /* Payslip table structure */
        .payslip-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 10px; }
        .payslip-table th, .payslip-table td { border: 1px solid #000; padding: 8px; text-align: left; }
        .payslip-table th { background-color: #eee; font-weight: bold; text-align: center; }

        /* Employee Details Section */
        .payslip-details { margin-bottom: 15px; }
        .payslip-details table { width: 100%; border-collapse: collapse; table-layout: fixed;}
        .payslip-details td { padding: 5px 10px; border: 1px solid #000; font-size: 0.9rem; }
        .payslip-details .label { font-weight: bold; width: 25%; background-color: #f1f1f1; }
        .payslip-details .value { width: 25%; }

        /* Totals and Net Payable */
        .total-row td { font-weight: bold; background-color: #e9e9e9; }
        .total-row td:nth-child(2), .total-row td:nth-child(4) { text-align: right; }
        .payslip-table td.amount { text-align: right; }

        .net-salary-section { margin-top: 20px; border: 2px solid #000; padding: 12px; font-size: 1.1rem; font-weight: bold; background-color: #d4edda; color: #155724; border-color: #c3e6cb; }

/* Footer and Signature */
.footer { 
    text-align: left;
    margin-top: 30px; 
    font-size: 0.8rem; 
    padding-left: 50px;
}
.signature-box { 
    display: inline-block; 
    text-align: center;
}
        .signature-box img { max-width: 150px; height: auto; display: block; margin: 0 auto; }
        .signature-box p { border-top: 1px solid #000; padding-top: 5px; margin: 0; font-weight: bold; }


        /* Print Styles */
        @media print {
            .input-form { display: none; }
            .generator-section { display: block; }
            .payslip { width: 100%; padding: 0; border: none; }
            .container { box-shadow: none; border: none; padding: 0; }
            .header { border-bottom: 1px solid #000; }
        }
    </style>
</head>
<body>

<div class="container" id="payslip-container">
    <div class="header">
        <img src="Groundup.png" alt="Groundup Logo">
        <h1>Salary Statement</h1>
        <p>For the Month of <span id="slip_month_display"></span></p>
    </div>

    <div class="generator-section">
        <div class="input-form">
            <div class="form-title">Enter Payslip Details</div>
            <form id="salaryForm">
                <div class="form-group">
                    <label for="input_month">Salary Month & Year (Variable):</label>
                    <input type="month" id="input_month" value="2025-11" required>
                </div>
                
                <div class="form-title" style="margin-top: 20px;">Employee Info (Common)</div>
                <div class="form-group">
                    <label for="input_name">Employee Name:</label>
                    <input type="text" id="input_name" value="Preety" required>
                </div>
                <div class="form-group">
                    <label for="input_designation">Designation:</label>
                    <input type="text" id="input_designation" value="Regional Manager">
                </div>
                <div class="form-group">
                    <label for="input_pan">PAN:</label>
                    <input type="text" id="input_pan" value="FQLPS5831M">
                </div>

                <div class="form-title" style="margin-top: 20px;">Monthly Variable Data (From XL Sheet)</div>

                <div class="form-group">
                    <label for="input_paid_leaves">Paid Leave (Days):</label>
                    <input type="number" id="input_paid_leaves" value="0" min="0">
                </div>
                <div class="form-group">
                    <label for="input_unpaid_leaves">Unpaid Leaves (Days):</label>
                    <input type="number" id="input_unpaid_leaves" value="0" min="0" required>
                </div>
                <div class="form-group">
                    <label for="input_basic">Basic (Monthly):</label>
                    <input type="number" id="input_basic" value="40000" required>
                </div>
                <div class="form-group">
                    <label for="input_hra">HRA (Monthly):</label>
                    <input type="number" id="input_hra" value="15000" required>
                </div>
                <div class="form-group">
                    <label for="input_arrears">Arrears/Incentive (Earning) (Variable):</label>
                    <input type="number" id="input_arrears" value="75000">
                </div>

                <div class="form-title" style="margin-top: 20px;">Deduction Components (Variable)</div>
                <div class="form-group">
                    <label for="input_pt">Professional Tax (TDS/PT Column):</label>
                    <input type="number" id="input_pt" value="200" min="0" required>
                </div>
                <div class="form-group">
                    <label for="input_tds">TDS (TDS/PT Column):</label>
                    <input type="number" id="input_tds" value="0" min="0" required>
                </div>
                 <div class="form-group">
                    <label for="input_loan">Loan / Other Deduction (Variable):</label>
                    <input type="number" id="input_loan" value="0" min="0">
                </div>

                <button type="submit">Generate / Update Payslip & Save PDF</button>
                
                <button type="button" onclick="window.print()" style="background-color: #28a745;">Print</button>
                
                <button type="button" id="shareEmailBtn" style="background-color: #17a2b8;">Share via Email</button>

            </form>
        </div>

        <div class="payslip">
            <div class="form-title" style="border-bottom: 2px solid #000; color: #333;">Employee Details</div>
            <div class="payslip-details">
                <table>
                    <tr>
                        <td class="label">Employee Name</td>
                        <td class="value" id="slip_name"></td>
                        <td class="label">Designation</td>
                        <td class="value" id="slip_designation"></td>
                    </tr>
                    <tr>
                        <td class="label">PAN</td>
                        <td class="value" id="slip_pan"></td>
                        <td class="label">Paid Leave (Days)</td>
                        <td class="value" id="slip_paid_leaves"></td>
                    </tr>
                    <tr>
                         <td class="label">Unpaid Leaves (Days)</td>
                        <td class="value" id="slip_unpaid_leaves"></td>
                        <td class="label"></td>
                        <td class="value"></td>
                    </tr>
                </table>
            </div>

            <div class="form-title" style="border-bottom: 2px solid #000; color: #333;">Earnings and Deductions</div>
            <table class="payslip-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">Earning Head</th>
                        <th style="width: 20%;">Amount</th>
                        <th style="width: 30%;">Deduction Head</th>
                        <th style="width: 20%;">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Basic</td>
                        <td class="amount" id="slip_basic"></td>
                        <td>Professional Tax</td>
                        <td class="amount" id="slip_pt"></td>
                    </tr>
                    <tr>
                        <td>HRA</td>
                        <td class="amount" id="slip_hra"></td>
                        <td>TDS</td>
                        <td class="amount" id="slip_tds"></td>
                    </tr>
                    <tr>
                        <td>Special Allowance/Other</td>
                        <td class="amount" id="slip_sa"></td>
                        <td>Loan / Other Deduction</td>
                        <td class="amount" id="slip_loan"></td>
                    </tr>
                    <tr>
                        <td>Arrears/Incentive</td>
                        <td class="amount" id="slip_arrears"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="total-row">
                        <td><b>TOTAL EARNINGS</b></td>
                        <td class="amount" id="slip_total_earnings"></td>
                        <td><b>TOTAL DEDUCTIONS</b></td>
                        <td class="amount" id="slip_total_deductions"></td>
                    </tr>
                </tbody>
            </table>

            <div class="net-salary-section" style="background-color: #d4edda; color: #155724; border-color: #c3e6cb;">
                <span><B>NET PAYABLE:</b> â‚¹</span><span id="slip_net_salary"></span>
            </div>

             <div class="net-salary-section" style="margin-top: 10px; font-size: 0.95rem; background-color: #fff3cd; color: #856404; border-color: #ffeeba;">
                <span>Rupees in words: </span><span id="slip_net_salary_in_words"></span>
            </div>

            <div class="footer">
                <div class="signature-box">
                    <img src="Authorized.png" alt="Authorized Signature" style="max-height: 50px; margin-bottom: -5px;">
                    <p>Authorized Signature</p>
					<p>Swapnil Chaudhari- Founder</p>
					
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Form submit now calls savePayslipAsPDF
    document.getElementById('salaryForm').addEventListener('submit', function(event) {
        event.preventDefault();
        // This function now updates the slip AND saves the PDF
        savePayslipAsPDF();
    });

    // savePayslipAsPDF() function
    function savePayslipAsPDF() {
        // 1. Ensure data is up-to-date on screen
        generatePayslip(); 

        const monthYear = document.getElementById('slip_month_display').textContent.replace(/\s/g, '_');
        const name = document.getElementById('input_name').value;
        const filename = `Payslip_${name}_${monthYear}.pdf`;

        // Get the elements
        const formElement = document.querySelector('.input-form');
        const containerElement = document.getElementById('payslip-container');

        // 2. Temporarily hide the form and remove borders for a clean PDF
        formElement.style.display = 'none'; 
        containerElement.style.boxShadow = 'none'; 
        containerElement.style.border = 'none'; 
        
        const options = {
            margin: 10,
            filename: filename,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // 3. Generate the PDF and trigger download
        html2pdf().set(options).from(containerElement).save().then(() => {
            // 4. Restore the form and styles after PDF is saved
            formElement.style.display = 'block';
            containerElement.style.boxShadow = '0 0 10px rgba(0,0,0,0.1)';
            containerElement.style.border = '1px solid #ccc';
        });
    }

    // --- UPDATED: Event Listener for Share Button (Outlook specific) ---
    document.getElementById('shareEmailBtn').addEventListener('click', function() {
        // Ensure payslip data is current before sharing
        generatePayslip();

        const fullName = document.getElementById('input_name').value;
        const month = document.getElementById('slip_month_display').textContent;
        
        if (!fullName) {
            alert('Please enter an employee name.');
            return;
        }

        const firstName = fullName.split(' ')[0].toLowerCase();
        const emailTo = `${firstName}@groundupasia.com`;
        const cc = 'harvinder@groundupasia.com';
        const subject = `Salary Slip for ${fullName} - ${month}`;
        const body = `Hi ${fullName.split(' ')[0]},\n\nPlease find your salary slip for ${month} attached.\n\n(Note for sender: The PDF was already downloaded when you clicked 'Generate'. Please attach that file to this email.)\n\nBest regards,\nGroundup`;
        
        // --- NEW OUTLOOK URL ---
        let outlookURL = `https://outlook.office.com/mail/deeplink/compose`;
        outlookURL += `?to=${encodeURIComponent(emailTo)}`;
        outlookURL += `&cc=${encodeURIComponent(cc)}`;
        outlookURL += `&subject=${encodeURIComponent(subject)}`;
        outlookURL += `&body=${encodeURIComponent(body)}`;
        
        // Open Outlook in a new tab
        window.open(outlookURL, '_blank');
    });


    // --- Helper function to convert number to Indian currency words (Unchanged) ---
    function numberToWords(n) {
        if (n === 0) return "ZERO RUPEES ONLY";
        
        const units = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
        const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
        const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

        const convertLessThanOneThousand = (num) => {
            let str = '';
            if (num >= 100) {
                str += units[Math.floor(num / 100)] + ' Hundred ';
                num %= 100;
            }
            if (num >= 10 && num <= 19) {
                str += teens[num - 10];
            } else {
                str += tens[Math.floor(num / 10)] + ' ' + units[num % 10];
            }
            return str.trim();
        };

        let num = Math.floor(n);
        let output = '';

        if (num >= 10000000) {
            output += convertLessThanOneThousand(Math.floor(num / 10000000)) + ' Crore ';
            num %= 10000000;
        }
        if (num >= 100000) {
            output += convertLessThanOneThousand(Math.floor(num / 100000)) + ' Lakh ';
            num %= 100000;
        }
        if (num >= 1000) {
            output += convertLessThanOneThousand(Math.floor(num / 1000)) + ' Thousand ';
            num %= 1000;
        }
        if (num > 0) {
            output += convertLessThanOneThousand(num);
        }

        return (output.trim() + ' Rupees Only').toUpperCase().replace(/\s+/g, ' ');
    }

    // --- Helper function for Indian currency formatting (Unchanged) ---
    function formatCurrency(amount) {
        return parseFloat(amount).toLocaleString('en-IN', {
            style: 'decimal', 
            minimumFractionDigits: 0,
            maximumFractionDigits: 2
        });
    }

    // --- Main function to populate slip data (Unchanged) ---
    function generatePayslip() {
        // --- 1. Get Input Values ---
        const monthInput = document.getElementById('input_month').value;
        const monthYear = new Date(monthInput + '-01').toLocaleString('en-US', { month: 'long', year: 'numeric' });

        const name = document.getElementById('input_name').value;
        const designation = document.getElementById('input_designation').value;
        const pan = document.getElementById('input_pan').value;
        
        const specialAllowance = 19300; 
        const lta = 2000; 

        const paidLeaves = parseFloat(document.getElementById('input_paid_leaves').value) || 0;
        const unpaidLeaves = parseFloat(document.getElementById('input_unpaid_leaves').value) || 0;
        
        const basic = parseFloat(document.getElementById('input_basic').value) || 0;
        const hra = parseFloat(document.getElementById('input_hra').value) || 0;
        const arrears = parseFloat(document.getElementById('input_arrears').value) || 0;

        const pt = parseFloat(document.getElementById('input_pt').value) || 0;
        const tds = parseFloat(document.getElementById('input_tds').value) || 0;
        const loan = parseFloat(document.getElementById('input_loan').value) || 0;

        // --- 2. Calculations ---
        const totalEarnings = basic + hra + lta + specialAllowance + arrears;
        const totalDeductions = pt + tds + loan; 
        const netSalary = totalEarnings - totalDeductions;

        // --- 3. Populate Payslip Fields ---
        document.getElementById('slip_month_display').textContent = monthYear;
        
        // Employee Details
        document.getElementById('slip_name').textContent = name;
        document.getElementById('slip_designation').textContent = designation;
        document.getElementById('slip_pan').textContent = pan;
        document.getElementById('slip_paid_leaves').textContent = paidLeaves;
        document.getElementById('slip_unpaid_leaves').textContent = unpaidLeaves;
        
        // Earnings
        document.getElementById('slip_basic').textContent = formatCurrency(basic);
        document.getElementById('slip_hra').textContent = formatCurrency(hra);
        document.getElementById('slip_sa').textContent = formatCurrency(specialAllowance + lta); 
        document.getElementById('slip_arrears').textContent = formatCurrency(arrears);

        // Deductions
        document.getElementById('slip_pt').textContent = formatCurrency(pt);
        document.getElementById('slip_tds').textContent = formatCurrency(tds);
        document.getElementById('slip_loan').textContent = formatCurrency(loan);

        // Totals
        document.getElementById('slip_total_earnings').textContent = formatCurrency(totalEarnings);
        document.getElementById('slip_total_deductions').textContent = formatCurrency(totalDeductions);
        document.getElementById('slip_net_salary').textContent = formatCurrency(netSalary);
        document.getElementById('slip_net_salary_in_words').textContent = numberToWords(netSalary);
    }
    
    // Generate with default values on load
    document.addEventListener('DOMContentLoaded', generatePayslip);
</script>

</body>
</html>