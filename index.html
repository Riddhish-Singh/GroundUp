<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groundup Pay Slip Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        /* Base styles */
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); box-sizing: border-box; } 

        /* Header and Logo */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .header img { 
            max-width: 150px; 
            height: auto; 
            margin-bottom: 10px; 
            border: none; 
            padding: 5px; 
        }
        .header h1 { font-size: 1.8rem; color: #333; margin-bottom: 5px;}
        .header p { font-size: 1rem; color: #555; }

        /* Two-Column Generator Layout */
        .generator-section { display: flex; gap: 30px; }
        .input-form { width: 35%; background-color: #f9f9f9; padding: 15px; border: 1px solid #ddd; border-radius: 5px;}
        .payslip { width: 65%; background-color: #fff; padding: 10px 0; }

        /* Form styling */
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 3px; color: #333; }
        .form-group input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; font-size: 0.9rem; }
        .form-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid #555; padding-bottom: 5px; color: #007bff; }
        .input-form button { width: 100%; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; margin-top: 15px; }
        .input-form button:hover { background-color: #0056b3; }

        /* Payslip table structure */
        .payslip-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
        .payslip-table th, .payslip-table td { border: 1px solid #000; padding: 6px 8px; text-align: left; }
        .payslip-table th { background-color: #eee; font-weight: bold; text-align: center; }

        /* Employee Details Section */
        .payslip-details { margin-bottom: 15px; }
        .payslip-details table { width: 100%; border-collapse: collapse; table-layout: fixed;}
        .payslip-details td { padding: 5px 10px; border: 1px solid #000; font-size: 0.85rem; }
        .payslip-details .label { font-weight: bold; width: 25%; background-color: #f1f1f1; }
        .payslip-details .value { width: 25%; }

        /* Totals and Net Payable */
        .total-row td { font-weight: bold; background-color: #e9e9e9; }
        .total-row td:nth-child(2), .total-row td:nth-child(4) { text-align: right; }
        .payslip-table td.amount { text-align: right; }

        .net-salary-section { margin-top: 20px; border: 2px solid #000; padding: 12px; font-size: 1.1rem; font-weight: bold; background-color: #d4edda; color: #155724; border-color: #c3e6cb; }

        .footer { text-align: left; margin-top: 30px; font-size: 0.8rem; padding-left: 50px; }

        /* --- PDF GENERATION STYLES (CORRECTED) --- */
        /* This class is added to the body during PDF generation */
        body.generating-pdf .input-form {
            display: none !important; /* Hide form */
        }
        body.generating-pdf .payslip {
            width: 100% !important; /* Payslip takes full width */
            padding: 0 !important;
        }
        body.generating-pdf .container {
            /* FIXED: Reduced width to 750px to fit inside A4 margins (approx 794px total width) */
            width: 750px !important; 
            max-width: 750px !important;
            margin: 0 auto !important;
            box-shadow: none !important;
            border: none !important;
            /* FIXED: Removed padding so it doesn't push content off the edge */
            padding: 0px !important; 
        }
        body.generating-pdf {
            background-color: white !important; /* Remove grey background */
            padding: 0 !important;
        }
    </style>
</head>
<body>

<div class="container" id="payslip-container">
    <div class="header">
        <img src="Groundup.png" alt="Groundup Logo">
        <h1>Pay Slip</h1>
        <p>For the Month of <span id="slip_month_display"></span></p>
    </div>

    <div class="generator-section">
        <div class="input-form">
            <div class="form-title">Enter Payslip Details</div>
            <form id="salaryForm">
                <div class="form-group">
                    <label for="input_month">Salary Month & Year:</label>
                    <input type="month" id="input_month" value="2025-11" required>
                </div>
                
                <div class="form-title" style="margin-top: 20px;">Employee Info</div>
                <div class="form-group">
                    <label for="input_name">Employee Full Name:</label>
                    <input type="text" id="input_name" value="ABC ABC" required>
                </div>
                <div class="form-group">
                    <label for="input_designation">Designation:</label>
                    <input type="text" id="input_designation" value="Manager">
                </div>
                <div class="form-group">
                    <label for="input_doj">Date of Joining:</label>
                    <input type="date" id="input_doj" value="2023-01-15">
                </div>
                <div class="form-group">
                    <label for="input_pan">PAN:</label>
                    <input type="text" id="input_pan" value="XXXXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="input_bank">Bank Account No:</label>
                    <input type="text" id="input_bank" value="XXXX XXXX 1234">
                </div>

                <div class="form-title" style="margin-top: 20px;">Attendance & Earnings</div>
                <div class="form-group">
                    <label for="input_paid_leaves">Paid Leave (Days):</label>
                    <input type="number" id="input_paid_leaves" value="0" min="0">
                </div>
                <div class="form-group">
                    <label for="input_unpaid_leaves">Unpaid Leaves (Days):</label>
                    <input type="number" id="input_unpaid_leaves" value="0" min="0" required>
                </div>
                <div class="form-group">
                    <label for="input_basic">Basic (Monthly):</label>
                    <input type="number" id="input_basic" value="40000" required>
                </div>
                <div class="form-group">
                    <label for="input_hra">HRA (Monthly):</label>
                    <input type="number" id="input_hra" value="15000" required>
                </div>
                <div class="form-group">
                    <label for="input_lta">Leave Travel Allowance (Monthly):</label>
                    <input type="number" id="input_lta" value="2000">
                </div>
                <div class="form-group">
                    <label for="input_conveyance">Conveyance Allowance (Monthly):</label>
                    <input type="number" id="input_conveyance" value="1600">
                </div>
                <div class="form-group">
                    <label for="input_medical">Medical Allowance (Monthly):</label>
                    <input type="number" id="input_medical" value="1250">
                </div>
                <div class="form-group">
                    <label for="input_sa">Special Allowance/Other (Monthly):</label>
                    <input type="number" id="input_sa" value="15000">
                </div>
                <div class="form-group">
                    <label for="input_arrears">Arrears/Incentive (Monthly):</label>
                    <input type="number" id="input_arrears" value="0">
                </div>

                <div class="form-title" style="margin-top: 20px;">Deductions (Monthly)</div>
                <div class="form-group">
                    <label for="input_pt">Professional Tax (Monthly):</label>
                    <input type="number" id="input_pt" value="200" min="0" required>
                </div>
                <div class="form-group">
                    <label for="input_tds">TDS (Monthly):</label>
                    <input type="number" id="input_tds" value="0" min="0" required>
                </div>

                <button type="submit">Generate / Update Payslip</button>
                <button type="button" onclick="downloadPDF()" style="background-color: #28a745;">Save as PDF</button>
                <button type="button" id="shareEmailBtn" style="background-color: #17a2b8;">Share via Email</button>
            </form>
        </div>

        <div class="payslip">
            <div class="form-title" style="border-bottom: 2px solid #000; color: #333;">Employee Details</div>
            <div class="payslip-details">
                <table>
                    <tr>
                        <td class="label">Employee Name</td>
                        <td class="value" id="slip_name"></td>
                        <td class="label">Designation</td>
                        <td class="value" id="slip_designation"></td>
                    </tr>
                    <tr>
                        <td class="label">Date of Joining</td>
                        <td class="value" id="slip_doj"></td>
                        <td class="label">Pay Period</td>
                        <td class="value" id="slip_pay_period"></td>
                    </tr>
                    <tr>
                        <td class="label">PAN</td>
                        <td class="value" id="slip_pan"></td>
                        <td class="label">Bank A/c No</td>
                        <td class="value" id="slip_bank"></td>
                    </tr>
                    <tr>
                        <td class="label">Paid Leave (Days)</td>
                        <td class="value" id="slip_paid_leaves"></td>
                        <td class="label">Unpaid Leaves (Days)</td>
                        <td class="value" id="slip_unpaid_leaves"></td>
                    </tr>
                </table>
            </div>

            <div class="form-title" style="border-bottom: 2px solid #000; color: #333;">Earnings and Deductions</div>
            <table class="payslip-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">Earning Head</th>
                        <th style="width: 20%;">Amount</th>
                        <th style="width: 30%;">Deduction Head</th>
                        <th style="width: 20%;">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Basic</td>
                        <td class="amount" id="slip_basic"></td>
                        <td>Professional Tax</td>
                        <td class="amount" id="slip_pt"></td>
                    </tr>
                    <tr>
                        <td>HRA</td>
                        <td class="amount" id="slip_hra"></td>
                        <td>TDS</td>
                        <td class="amount" id="slip_tds"></td>
                    </tr>
                    <tr>
                        <td>Leave Travel Allowance (Monthly)</td>
                        <td class="amount" id="slip_lta"></td>
                        <td></td>
                        <td class="amount"></td>
                    </tr>
                    <tr>
                        <td>Conveyance Allowance (Monthly)</td>
                        <td class="amount" id="slip_conveyance"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Medical Allowance (Monthly)</td>
                        <td class="amount" id="slip_medical"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Special Allowance (Monthly)/Other</td>
                        <td class="amount" id="slip_sa"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Arrears/Incentive</td>
                        <td class="amount" id="slip_arrears"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="total-row">
                        <td><b>TOTAL EARNINGS</b></td>
                        <td class="amount" id="slip_total_earnings"></td>
                        <td><b>TOTAL DEDUCTIONS</b></td>
                        <td class="amount" id="slip_total_deductions"></td>
                    </tr>
                </tbody>
            </table>

            <div class="net-salary-section">
                <span><B>NET PAYABLE:</b> â‚¹</span><span id="slip_net_salary"></span>
            </div>

             <div class="net-salary-section" style="margin-top: 10px; font-size: 0.95rem; background-color: #fff3cd; color: #856404; border-color: #ffeeba;">
                <span>Rupees in words: </span><span id="slip_net_salary_in_words"></span>
            </div>

            <div class="footer">
                <p class="font-medium">-- This is a system-generated document. --</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('salaryForm').addEventListener('submit', function(event) {
        event.preventDefault();
        generatePayslip();
    });

    document.getElementById('shareEmailBtn').addEventListener('click', function() {
        generatePayslip();
        const fullName = document.getElementById('input_name').value;
        const month = document.getElementById('slip_month_display').textContent;
        if (!fullName) { alert('Please enter an employee name.'); return; }

        const firstName = fullName.split(' ')[0].toLowerCase();
        const emailTo = `${firstName}@groundupasia.com`;
        const cc = 'harvinder@groundupasia.com';
        const subject = `Pay Slip for ${fullName} - ${month}`;
        const body = `Hi ${fullName.split(' ')[0]},\n\nPlease find your pay slip for ${month} attached.\n\nBest regards,\nGroundup`;
        
        let outlookURL = `https://outlook.office.com/mail/deeplink/compose?to=${encodeURIComponent(emailTo)}&cc=${encodeURIComponent(cc)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.open(outlookURL, '_blank');
    });

    // ROBUST PDF FUNCTION
    function downloadPDF() {
        generatePayslip();
        const empName = document.getElementById('input_name').value.trim() || 'Employee';
        const finalFileName = `${empName}_GroundUp Pay-Slip.pdf`;

        // 1. Add class to BODY to visually force A4 layout on screen
        document.body.classList.add('generating-pdf');

        const element = document.getElementById('payslip-container');

        const opt = {
            margin:       0.2, 
            filename:     finalFileName,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, useCORS: true, scrollY: 0 }, 
            jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        // 2. Generate PDF from the now properly sized container
        html2pdf().set(opt).from(element).save().then(() => {
            // 3. Remove class to restore original layout
            document.body.classList.remove('generating-pdf');
        }).catch((err) => {
            console.error(err);
            // Ensure we restore layout even if error occurs
            document.body.classList.remove('generating-pdf');
        });
    }

    function numberToWords(n) {
        if (n === 0) return "ZERO RUPEES ONLY";
        const units = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
        const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
        const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

        const convertLessThanOneThousand = (num) => {
            let str = '';
            if (num >= 100) { str += units[Math.floor(num / 100)] + ' Hundred '; num %= 100; }
            if (num >= 10 && num <= 19) { str += teens[num - 10]; } 
            else { str += tens[Math.floor(num / 10)] + ' ' + units[num % 10]; }
            return str.trim();
        };

        let num = Math.floor(n);
        let output = '';
        if (num >= 10000000) { output += convertLessThanOneThousand(Math.floor(num / 10000000)) + ' Crore '; num %= 10000000; }
        if (num >= 100000) { output += convertLessThanOneThousand(Math.floor(num / 100000)) + ' Lakh '; num %= 100000; }
        if (num >= 1000) { output += convertLessThanOneThousand(Math.floor(num / 1000)) + ' Thousand '; num %= 1000; }
        if (num > 0) { output += convertLessThanOneThousand(num); }
        return (output.trim() + ' Rupees Only').toUpperCase().replace(/\s+/g, ' ');
    }

    function formatCurrency(amount) {
        return parseFloat(amount).toLocaleString('en-IN', { style: 'decimal', minimumFractionDigits: 0, maximumFractionDigits: 2 });
    }

    function generatePayslip() {
        const monthInput = document.getElementById('input_month').value;
        const dateObj = new Date(monthInput + '-01');
        const monthYear = dateObj.toLocaleString('en-US', { month: 'long', year: 'numeric' });

        document.getElementById('slip_month_display').textContent = monthYear;
        document.getElementById('slip_pay_period').textContent = monthYear;
        document.getElementById('slip_name').textContent = document.getElementById('input_name').value;
        document.getElementById('slip_designation').textContent = document.getElementById('input_designation').value;
        document.getElementById('slip_pan').textContent = document.getElementById('input_pan').value;
        document.getElementById('slip_bank').textContent = document.getElementById('input_bank').value;
        
        const dojValue = document.getElementById('input_doj').value;
        document.getElementById('slip_doj').textContent = dojValue ? new Date(dojValue).toLocaleDateString('en-GB') : 'N/A';

        document.getElementById('slip_paid_leaves').textContent = document.getElementById('input_paid_leaves').value || 0;
        document.getElementById('slip_unpaid_leaves').textContent = document.getElementById('input_unpaid_leaves').value || 0;
        
        const basic = parseFloat(document.getElementById('input_basic').value) || 0;
        const hra = parseFloat(document.getElementById('input_hra').value) || 0;
        const lta = parseFloat(document.getElementById('input_lta').value) || 0;
        const conveyance = parseFloat(document.getElementById('input_conveyance').value) || 0;
        const medical = parseFloat(document.getElementById('input_medical').value) || 0;
        const specialAllowance = parseFloat(document.getElementById('input_sa').value) || 0;
        const arrears = parseFloat(document.getElementById('input_arrears').value) || 0;
        
        const pt = parseFloat(document.getElementById('input_pt').value) || 0;
        const tds = parseFloat(document.getElementById('input_tds').value) || 0;

        const totalEarnings = basic + hra + lta + conveyance + medical + specialAllowance + arrears;
        const totalDeductions = pt + tds; 
        const netSalary = totalEarnings - totalDeductions;

        document.getElementById('slip_basic').textContent = formatCurrency(basic);
        document.getElementById('slip_hra').textContent = formatCurrency(hra);
        document.getElementById('slip_lta').textContent = formatCurrency(lta);
        document.getElementById('slip_conveyance').textContent = formatCurrency(conveyance);
        document.getElementById('slip_medical').textContent = formatCurrency(medical);
        document.getElementById('slip_sa').textContent = formatCurrency(specialAllowance); 
        document.getElementById('slip_arrears').textContent = formatCurrency(arrears);
        
        document.getElementById('slip_pt').textContent = formatCurrency(pt);
        document.getElementById('slip_tds').textContent = formatCurrency(tds);

        document.getElementById('slip_total_earnings').textContent = formatCurrency(totalEarnings);
        document.getElementById('slip_total_deductions').textContent = formatCurrency(totalDeductions);
        document.getElementById('slip_net_salary').textContent = formatCurrency(netSalary);
        document.getElementById('slip_net_salary_in_words').textContent = numberToWords(netSalary);
    }
    
    document.addEventListener('DOMContentLoaded', generatePayslip);
</script>
</body>
</html>